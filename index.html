<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Skynet limited links</title>
        <link rel="stylesheet" type="text/css" href="style.css?v=1">
        <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap-grid.css" rel="stylesheet">
        <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    </head>
    <body>
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="622" viewBox="0 0 622 151" class="top-swoosh"><defs><filter id="a" width="103.4%" height="103.4%" x="-1.7%" y="-1.7%" filterUnits="objectBoundingBox"><feMorphology in="SourceAlpha" operator="dilate" radius="1" result="shadowSpreadOuter1"></feMorphology><feOffset in="shadowSpreadOuter1" result="shadowOffsetOuter1"></feOffset><feMorphology in="SourceAlpha" radius="1" result="shadowInner"></feMorphology><feOffset in="shadowInner" result="shadowInner"></feOffset><feComposite in="shadowOffsetOuter1" in2="shadowInner" operator="out" result="shadowOffsetOuter1"></feComposite><feGaussianBlur in="shadowOffsetOuter1" result="shadowBlurOuter1" stdDeviation="4"></feGaussianBlur><feColorMatrix in="shadowBlurOuter1" values="0 0 0 0 0.341176471 0 0 0 0 0.709803922 0 0 0 0 0.376470588 0 0 0 0.3 0"></feColorMatrix></filter><path id="b" d="M384 768c212.077 0 384-171.923 384-384S596.077 0 384 0 0 171.923 0 384s171.923 384 384 384zm192-51.446c-91.832 53.02-252.238-52.89-358.277-236.554C111.684 296.336 100.168 104.466 192 51.446"></path></defs><g fill="none" fill-rule="evenodd"><g stroke-linejoin="round" transform="translate(-73 -626)"><use fill="#000" filter="url(#a)" xlink:href="#b"></use><use stroke="#2B6CB0" stroke-width="2" xlink:href="#b"></use></g><path fill="#3182CE" d="M119.706-574.998l-.78.524C27.13-521.461 38.642-329.612 144.64-145.968 250.637 37.676 410.982 143.572 502.779 90.559l.218-.052C446.488 123.254 380.859 142 310.853 142 98.857 142-73-29.904-73-241.957c0-142.44 77.542-266.765 192.706-333.04z"></path></g></svg>


        <h1 class="text-center top">Limited Skynet links</h1>
        <p class="text-center top-info">Do not store sensitive data on Skynet
            <span class="tooltip" title="On Skynet, every file is unencrypted, so even if you don't share the link, it may be available in theory. If you still want to store sensitive data, encrypt it before uploading or use Sia without Skynet!">
                <i class="fa fa-info-circle"></i>
            </span>
        </p>
        <div class="border p-3 m-auto">
            <form method="POST" action="new/index.php" class="home-upload-retrieve-form p-5 text-center" id="form">
                <input type="text" name="skylink" placeholder="Skylink" class="big" autocomplete>
                <span class="tooltip" title="For example: CABAB_1Dt0FJsxqsu_J4TodNCbCGvtFf1Uys_3EgzOlTcg">
                    <i class="fa fa-info-circle"></i>
                </span>
                <p>Optional limits <span style="opacity: 0.6">(leave empty what you don't need)</span></p>

                <p>Downloadable <input type="number" name="downloadable"> times
                    <span class="tooltip" title="After the file was opened x times, the link won't work.">
                        <i class="fa fa-info-circle"></i>
                    </span>
                </p>

                <p>Expire after <input type="number" name="expire_value" class="mr-0">
                    <select name="expire_unit" class="ml-0">
                        <option disabled selected value>-select-</option>
                        <option value="minute">Minutes</option>
                        <option value="hour">Hours</option>
                        <option value="day">Days</option>
                        <option value="week">Weeks</option>
                        <option value="month">Months</option>
                    </select>
                    
                    <span class="tooltip" title="After this time, the link won't work.">
                        <i class="fa fa-info-circle"></i>
                    </span>
                </p>

                <p>File password <input type="password" name="password" placeholder="Password">
                    <span class="tooltip" title="The password required to open the file.">
                        <i class="fa fa-info-circle"></i>
                    </span>
                </p>
                
                <button type="submit" class="button" id="sendbtn"><i class="fa fa-share mr-2"></i>Generate link</button>
            </form>
            <div class="home-uploaded-files">
                <div class="upload-file" id="sample_upload">
                    <div class="upload-file-icon"><svg width="38" height="42" viewBox="0 0 38 42"><g fill="none" fill-rule="evenodd"><path d="M3 1h18l16 16v22a2 2 0 01-2 2H3a2 2 0 01-2-2V3a2 2 0 012-2zm12 24l3 3 5-5" stroke="#2B6CB0" stroke-width="2" stroke-linejoin="round"></path><path d="M21 2l15 15H23a2 2 0 01-2-2V2z" fill="#2B6CB0"></path></g></svg></div>
                        <div class="upload-file-text">
                            <p><a href="https://siasky.net/AABdiNgRpWhpApfSrLyZqEnEw-9xQY_5Feb_2rOdZMBDzQ" class="url green-text">https://siasky.net/AABdiNgRpWhpApfSrLyZqEnEw-9xQY_5Feb_2rOdZMBDzQ</a></p>
                        </div>
                        <span class="tooltip" title="Copy to clipboard">
                            <button class="upload-file-copy" onclick="copyClip('1')">
                                <div class="upload-file-copy-button">Copy Link
                                    <svg width="12" height="14" viewBox="0 0 12 14">
                                        <path d="M8 1H4a3 3 0 00-3 3v6h0m4-6h5a1 1 0 011 1v7a1 1 0 01-1 1H5a1 1 0 01-1-1V5a1 1 0 011-1z" stroke="currentColor" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linejoin="round"></path>
                                    </svg>
                                </div>
                                <input readonly="" value="https://siasky.net/AABdiNgRpWhpApfSrLyZqEnEw-9xQY_5Feb_2rOdZMBDzQ" id="1">
                            </button>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

        <script src="https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.0.8/dist/jBox.all.min.js"></script>
        <link href="https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.0.8/dist/jBox.all.min.css" rel="stylesheet">

        <script>

            // Initialize tooltips
            new jBox('Tooltip', {
                attach: '.tooltip',
                    closeOnMouseleave: true
            });

            // Copy to clipboard buttons
            function copyClip(inputId) {
                var copyText = document.getElementById(inputId);
                copyText.select();
                copyText.setSelectionRange(0, 99999); /*For mobile devices*/
                document.execCommand("copy");
            } 


            // form submit
            $("#form").submit(function(event){
                event.preventDefault();

                $('#sendbtn').prop("disabled", true);

                // Remove empty values on form submit (required for api)
                var myForm = document.getElementById('form');
                var allInputs = myForm.getElementsByTagName('input');
                for (var i = 0; i < allInputs.length; i++) {
                    var input = allInputs[i];

                    if (input.name && !input.value) {
                        input.name = '';
                    }
                }

                var post_url = $(this).attr("action");
                var request_method = $(this).attr("method");
                var form_data = $(this).serialize();
                $.ajax({
                    url : post_url,
                    type: request_method,
                    data : form_data,
                    dataType: "json"
                }).done(function(response){
                    if (typeof response.error !== 'undefined') {
                        alert('Error: ' + response.error);
                    } else {
                        $(".home-uploaded-files").css('display', 'inherit');

                        var divClone = $("#sample_upload").clone();
                        divClone.attr("id", "");
                        divClone.find('a').attr('href', response.url);
                        divClone.find('a').html(response.url);
                        divClone.find('input').val(response.url);
                        divClone.find('input').attr('id', response.id);
                        divClone.find('button').attr('onclick', "copyClip('" + response.id + "')");

                        $(divClone).prependTo('.home-uploaded-files');		
                    }
                }).fail(function(response){

                    if (typeof response.responseJSON.error !== 'undefined') {
                        alert('Failed: ' + response.responseJSON.error);
                    } else {
                        alert('Some error happened');
                    }
                }).always(function(){
                    $('#sendbtn').prop("disabled", false);
                });
            });
        </script>
    </body>
</html>